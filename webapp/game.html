<!DOCTYPE html>
<html>
<head>
    <title>Hero Wars Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        .hero-card { border: 1px solid #ccc; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .team-builder { display: flex; flex-wrap: wrap; gap: 10px; }
        .active { border-color: gold; background-color: #fff9c4; }
    </style>
</head>
<body>
    <div id="app">
        <h1>üéÆ Hero Wars</h1>
        
        <div id="user-info"></div>
        
        <div class="tabs">
            <button onclick="showTab('heroes')">–ú–æ–∏ –ì–µ—Ä–æ–∏</button>
            <button onclick="showTab('team')">–ö–æ–º–∞–Ω–¥–∞</button>
            <button onclick="showTab('battle')">–ë–∏—Ç–≤–∞</button>
        </div>
        
        <div id="heroes-tab" class="tab-content">
            <div id="heroes-list"></div>
        </div>
        
        <div id="team-tab" class="tab-content" style="display:none">
            <div class="team-builder" id="team-builder"></div>
            <button onclick="saveTeam()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É</button>
        </div>
        
        <div id="battle-tab" class="tab-content" style="display:none">
            <button onclick="findBattle()">‚öîÔ∏è –ù–∞–π—Ç–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞</button>
            <div id="battle-result"></div>
        </div>
    </div>

    <script>
        let userData = null;
        let heroes = [];
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        
        async function loadGameData() {
            const tgUser = Telegram.WebApp.initDataUnsafe.user;
            const response = await fetch('/api/game-data', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ telegramId: tgUser.id })
            });
            
            const data = await response.json();
            userData = data.user;
            heroes = data.heroes;
            
            renderUserInfo();
            renderHeroes();
            renderTeamBuilder();
        }
        
        function renderUserInfo() {
            document.getElementById('user-info').innerHTML = `
                <p>–£—Ä–æ–≤–µ–Ω—å: ${userData.level} | –ó–æ–ª–æ—Ç–æ: ${userData.gold} | –°–∞–º–æ—Ü–≤–µ—Ç—ã: ${userData.gems}</p>
            `;
        }
        
        function renderHeroes() {
            const container = document.getElementById('heroes-list');
            container.innerHTML = heroes.map(hero => `
                <div class="hero-card">
                    <h3>${hero.name} (–£—Ä. ${hero.level})</h3>
                    <p>‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ: ${hero.health} | ‚öîÔ∏è –ê—Ç–∞–∫–∞: ${hero.attack}</p>
                    <p>üõ°Ô∏è –ó–∞—â–∏—Ç–∞: ${hero.defense} | üèÉ –°–∫–æ—Ä–æ—Å—Ç—å: ${hero.speed}</p>
                    <button onclick="upgradeHero(${hero.id})">–£–ª—É—á—à–∏—Ç—å (${hero.level * 100} –∑–æ–ª–æ—Ç–∞)</button>
                </div>
            `).join('');
        }
        
        async function upgradeHero(heroId) {
            const result = await sendDataToBot({
                action: 'upgrade_hero',
                heroId: heroId,
                userId: userData.id
            });
            
            if (result.success) {
                loadGameData(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            }
        }
        
        function sendDataToBot(data) {
            return Telegram.WebApp.sendData(JSON.stringify(data));
        }
        
        loadGameData();
    </script>
</body>
</html>
